library(censusapi) 
library(tidyverse)
library(dplyr)
library(extrafont)
library(scales)
library(directlabels)
library(grid)
library(here)
library(knitr)
library(readxl)
library(xfun)

#HT created this in the 2024 who lives to be a crosswalk to the Louisiana and US design factors to calculate error for the 2000's data in the wholivesdatapull2000 in the functions.R file.
Census2000_designfac <- read_xlsx("inputs/2000_census/Census2000SF3_designfac.xlsx")

#load("inputs/allparishesRawx.RData")

library(AzureAuth) ## to connect with credentials
library(AzureStor) ## to access the stored data

## install azure cli: https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-windows?tabs=azure-cli
## sign in to Azure using your AAD un/pw in the terminal/commandline: az login 
## get token in terminal/commandline: az account get-access-token --resource https://datacenterdc2datalake.blob.core.windows.net/

### define your token 

token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IktRMnRBY3JFN2xCYVZWR0JtYzVGb2JnZEpvNCIsImtpZCI6IktRMnRBY3JFN2xCYVZWR0JtYzVGb2JnZEpvNCJ9.eyJhdWQiOiJodHRwczovL2RhdGFjZW50ZXJkYzJkYXRhbGFrZS5ibG9iLmNvcmUud2luZG93cy5uZXQvIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvNzQ5YzFmYmEtMmMyOS00YTBmLTg3ZGEtODc3NjQ3YmJiZDg2LyIsImlhdCI6MTcyMzQ5NDMzNSwibmJmIjoxNzIzNDk0MzM1LCJleHAiOjE3MjM0OTg4NTQsImFjciI6IjEiLCJhaW8iOiJBWlFBYS84WEFBQUFrc3dZV0tacVZpYmJuRTIvbWNsRkdiTEtJS24vQTYxcmRhRWMwb3dnRG5Wd1UrajVnQlRFZWxyMXhxWklLeTJ3SzREQU9NMmpwaGx3TUUwaVoxKzJPSzNaemRoTUQwOWpDeDJSa1lDR1V1c3pKVXdQeC80bUM3UmZWeVdRbkhpV3g4NWdlMTBxMDFQb3FUQ2xEN0ljdms3QWU4OHJ4cVFMYlQ4VmM4NDBTOVJGak5FSzdEQitEamIvOVlndFI2VUwiLCJhbXIiOlsicnNhIiwibWZhIl0sImFwcGlkIjoiMDRiMDc3OTUtOGRkYi00NjFhLWJiZWUtMDJmOWUxYmY3YjQ2IiwiYXBwaWRhY3IiOiIwIiwiZGV2aWNlaWQiOiI5ZDI5YThkNi1kNzUzLTQzOGUtYmJhMS1iNzVkZDZkOTI1NDIiLCJmYW1pbHlfbmFtZSI6Ikh5ZGUiLCJnaXZlbl9uYW1lIjoiQW5pc3NhIiwiZ3JvdXBzIjpbImFkMDk0OGFjLWFmNjgtNDQ5NS04Y2NkLTQxNGMzY2NmZjM3MyJdLCJpZHR5cCI6InVzZXIiLCJpcGFkZHIiOiIyMDguMTE3LjIwNy4xMjIiLCJuYW1lIjoiQW5pc3NhIEh5ZGUiLCJvaWQiOiI4OWE0NTBmNy04MTkwLTQxMDktYWIxNC0wNTdmNWE1YzJjYTYiLCJwdWlkIjoiMTAwMzIwMDM5ODc2NUMyNiIsInB3ZF91cmwiOiJodHRwczovL3BvcnRhbC5taWNyb3NvZnRvbmxpbmUuY29tL0NoYW5nZVBhc3N3b3JkLmFzcHgiLCJyaCI6IjAuQVNrQXVoLWNkQ2tzRDBxSDJvZDJSN3U5aG9HbUJ1VFU4NmhDa0xiQ3NDbEpldkVwQU9jLiIsInNjcCI6InVzZXJfaW1wZXJzb25hdGlvbiIsInN1YiI6IkplMG5qSUEzOElHdkdUM2RVd1BSRG5uWUJVR2UweUJsNG1kMGk0MlczTkkiLCJ0aWQiOiI3NDljMWZiYS0yYzI5LTRhMGYtODdkYS04Nzc2NDdiYmJkODYiLCJ1bmlxdWVfbmFtZSI6ImFuaXNzYWhAZGF0YWNlbnRlcnJlc2VhcmNoLm9yZyIsInVwbiI6ImFuaXNzYWhAZGF0YWNlbnRlcnJlc2VhcmNoLm9yZyIsInV0aSI6IjQxX1A5VUZPc0VXNFFBV1JGOFVEQUEiLCJ2ZXIiOiIxLjAiLCJ4bXNfaWRyZWwiOiIxIDE2In0.hTAMCQXBdgPsyTj-9Q07kQLnv4Ib_VEBsi6ROBhLMuSR5aZDlNxwQO8M3hLcxNfil8894xqJb7N5h89MjGXzcEIqt3OjGx5ivSfCI80AI-4UJVkXTdaSXqQ5-cCzJVq54JdLJQZ4haWU2292hckK_FaYco2PZPpw6uaZJUMLTKj8huJBMfMMqoz2YhZ_zUnl6hr5JWsv5ypP-gYhLEqGb3P9-0fbp6r1ubIiCOmD2779Qf0uC7YDwsTQ6RYs3Z-B-mdpLzGv6m-nHFH6u71jS_9isY8BKgApx47pFOghV1iFaUZJJ1Zw8u7C_NgIjjQ3JlXWIiwYYn-rZlrwMIKewg"

ad_endp_tok2 <- storage_endpoint("https://datacenterdc2datalake.blob.core.windows.net/", token=token) ## again, the rsource/URL

## Connections to some most-used containers.
cont_proj <- storage_container(ad_endp_tok2, "project") 
#df <- storage_read_csv(cont_proj, "who_lives/2022/inputs/WhoLives_longer.csv") %>% select(-1) #make sure this is updated within datalake - querying_WhoLives_factconsolidated

#to write back to azure, use storage_write_csv(df, cont_proj, "who_lives/2022/outputs/file_name")
